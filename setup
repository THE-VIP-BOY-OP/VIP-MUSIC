
#!/bin/bash

pprint (){
	cred='\033[0;31m'
	cgreen='\033[0;32m'
	cyellow='\033[0;33m'
	cblue='\033[0;34m'
	cpurple='\033[0;35m'
	eval "export color='$cpurple'"
	[ ! -z $2 ] && eval "export color=\"\$$2\""
    printf "$color $1"
}

color_reset(){ printf '\033[0;37m';}

yesnoprompt(){
	old_stty_cfg=$(stty -g)
	stty raw -echo ; answer=$(head -c 1)
	stty $old_stty_cfg
	echo "$answer" | grep -iq "^y"
}

update() {
	pprint "\n\nğ”ğ©ğğšğ­ğ¢ğ§ğ  ğ•ğ¢ğ© ğŒğ®ğ¬ğ¢ğœ ğğšğœğ¤ğšğ ğ ğ‹ğ¢ğ¬ğ­ğŸ˜.. "
	sudo apt update 2>&1 | grep "can be upgraded" &>/dev/null
	if [ $? -eq 0 ]; then
		pprint "ğ—¨ğ—½ğ—±ğ—®ğ˜ğ—² ğ—”ğ˜ƒğ—®ğ—¶ğ—¹ğ—®ğ—¯ğ—¹ğ—²..ğŸ–•" "cgreen"
		pprint "\n\ğ™³ğ™¾ ğšˆğ™¾ğš„ ğš†ğ™°ğ™½ğšƒ ğšƒğ™¾ ğ™°ğš„ğšƒğ™¾ ğš„ğ™¿ğ™¶ğšğ™°ğ™³ğ™´ğŸ¥±..? (y/n)?"
		if yesnoprompt; then
			pprint "\n\nğ”ğ©ğ ğ«ğšğğ¢ğ§ğ  ğğšğœğ¤ğšğ ğğ¬ğŸ˜‰.. "
			sudo apt upgrade -y &>/dev/null &&
			pprint "ğŸ‡©â€ŠğŸ‡´â€ŠğŸ‡³â€ŠğŸ‡ªâ€Šâœ…!\n\n" "cgreen" || (pprint "ğŸ‡«â€ŠğŸ‡¦â€ŠğŸ‡®â€ŠğŸ‡±â€Šâ.\n\n" "cred"; exit 1)
		else
			echo
		fi
	else
		pprint "ğŸ‡¦ğ¥ğ«ğğšğğ² ğŸ‡ºğ© ğŸ‡¹ğ¨ ğŸ‡©ğšğ­ğ\n\n" "cgreen"
	fi
}

packages(){
	if ! command -v pip &>/dev/null; then
		pprint "á´„á´á´œÊŸá´… É´á´á´› Ò“ÉªÉ´á´… á´˜Éªá´˜, à¹€É³à¸£Æ­Î±â„“â„“à¹€É³É  É³ÏƒÏ‰ğŸ¤§..."
		sudo apt install python3-pip -y 2>pypilog.txt 1>/dev/null &&
		pprint "ğ‡ğ„ğ‡ğ„ ğƒğğğ„âœ”.\n\n" "cgreen" || (pprint "ğğğ’ ğ…ğ€ğˆğ‹ğ„ğƒâŒ.\n\n" "cred"; exit 1)
	fi

	if ! command -v ffmpeg &>/dev/null; then
		pprint "Ğ¡Ñ²Æ±á“D ÅŠÑ²Æ­ Æ’ÏƒÏ…Î·D Ò“Ò“á´á´˜á´‡É¢, ğˆğ§ğ¬ğ­ğšğ¥ğ¥ğ¢ğ§ğ  ğğ¨ğ°ğŸ™‚..."
		if sudo apt install ffmpeg -y &>/dev/null;then
			pprint "âœŒï¸ ğŸ‡© ğŸ‡´â€ŠğŸ‡³â€ŠğŸ‡ªâ€Š  ğŸ‡§â€ŠğŸ‡¦â€ŠğŸ‡§â€ŠğŸ‡¾ âœŒï¸â€Š.\n\n" "cgreen"
		else
			pprint "ğŸ‡«â€ŠğŸ‡¦â€ŠğŸ‡®â€ŠğŸ‡±â€ŠğŸ‡ªâ€ŠğŸ‡©â€ŠğŸ˜—.\n\n" "cred"
			pprint "You need to install ffmpeg manually in order to deploy VipX Music, exiting...\n" "cblue"
			exit 1
		fi
	fi

	# Check ffmpeg version and warn user if necessary.
	fv=$(grep -Po 'version (3.*?) ' <<< $(ffmpeg -version)) &&
	pprint "Playing live streams not going to work since you have ffmpeg $fv, live streams are supported by version 4+.\n" "cblue"
}


node(){
	command -v npm &>/dev/null && return
	pprint "ğˆğ§ğ¬ğ­ğšğ¥ğ¥ğ¢ğ§ğ  ğğ¨ğğğ£ğ¬ and ğğ©ğ¦ğŸ˜…..  "
	curl -fssL https://deb.nodesource.com/setup_18.x | sudo -E bash - &>nodelog.txt &&
	sudo apt install nodejs -y &>>nodelog.txt &&
	sudo npm i -g npm &>>nodelog.txt &&
	pprint "ğ—¦ğ˜‚ğ—°ğ—°ğ—²ğ˜€ğ˜€!\n" "cgreen" || (pprint "FAIL.\n" "cred"; exit 1)
}


installation(){
	pprint "\n\nğ—¨ğ—½ğ—´ğ—¿ğ—®ğ—±ğ—¶ğ—»ğ—´ ğ—½ğ—¶ğ—½ ğ—”ğ—»ğ—± ğ—œğ—»ğ˜€ğ˜ğ—®ğ—¹ğ—¹ğ—¶ğ—»ğ—´ ğ——ğ—²ğ—½ğ—²ğ—»ğ—±ğ—²ğ—°ğ˜† ğ—£ğ—®ğ—¸ğ—®ğ—´ğ—²ğ˜€ğŸ“..."
	pip3 install -U pip &>>pypilog.txt &&
	pip3 install -U -r requirements.txt &>>pypilog.txt &&
	pprint "ğƒğ¨ğ§ğğŸ’.\n" "cgreen" && return
	pprint "ğ…ğšğ¢ğ¥ğğğŸ˜­.\n" "cred"
	exit 1
}

clear
pprint "ğŸ‡¼ğ„ğ‹ğ‚ğğŒğ„ ğŸ‡¹ğ ğŸ‡»ğˆğ ğŸ‡²ğ”ğ’ğˆğ‚ ğŸ‡¸ğ„ğ“ğ”ğ ğŸ‡®ğğ’ğ“ğ€ğ‹ğ‹ğ„ğ‘\n\n"
pprint "ğŸ’ğˆğ—³ ğ˜ğ—¼ğ˜‚ ğ’ğ—²ğ—² ğ€ğ—»ğ˜† ğ„ğ—¿ğ—¿ğ—¼ğ—¿ ğƒğ˜‚ğ—¿ğ—¶ğ—»ğ—´ ğˆğ—»ğ˜€ğ˜ğ—®ğ—¹ğ—¹ğ—®ğ˜ğ—¶ğ—¼ğ—» ğğ—¿ğ—¼ğ—°ğ—²ğ˜€ğ˜€, ğğ—¹ğ—²ğ—®ğ˜€ğ—² ğ‘ğ—²ğ—³ğ—²ğ—¿ ğ“ğ—¼ ğ“ğ—µğ—²ğ˜€ğ—² ğ…ğ—¶ğ—¹ğ—²ğ˜€ ğ…ğ—¼ğ—¿ ğ‹ğ—¼ğ—´ğ˜€:ğŸ‡®ğŸ‡³ "
pprint "\nâ™¥ğ…ğ—¼ğ—¿ ğğ—¼ğ—±ğ—² ğ‰ğ˜€ ğ„ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€ , ğ‚ğ—µğ—²ğ—°ğ—¸ğ—¼ğ˜‚ğ˜ ğğ—¼ğ—±ğ—²ğ—¹ğ—¼ğ—´.ğ˜ğ˜…ğ˜ğŸ—¯"
pprint "\nğŸ¤ğ…ğ—¼ğ—¿ ğğ˜†ğ—½ğ—¶ ğğ—®ğ—°ğ—¸ğ—®ğ—´ğ—²ğ˜€ ğ„ğ—¿ğ—¿ğ—¼ğ—¿ğ˜€ , ğ‚ğ—µğ—²ğ—°ğ—¸ğ—¼ğ˜‚ğ˜ ğğ˜†ğ—½ğ—¶ğ—¹ğ—¼ğ—´.ğ˜ğ˜…ğ˜ğŸ’­"
sleep 1
pprint "\n\sá´„Ê€Éªá´˜á´› É´á´‡á´‡á´…s sá´œá´…á´ á´˜Ê€Éªá´ ÉªÊŸá´‡É¢á´‡s ÉªÉ´ á´Ê€á´…á´‡Ê€ á´›á´ á´œá´˜á´…á´€á´›á´‡ & ÉªÉ´sá´›á´€ÊŸÊŸ á´˜á´€á´„á´‹á´€É¢á´‡sğŸ˜¼.\n"
sudo test

update
packages
node
installation
pprint "\n\n\n\n\nğŸ‡»â€ŠğŸ‡®â€ŠğŸ‡µ â€Š ğŸ‡²â€ŠğŸ‡ºâ€ŠğŸ‡¸â€ŠğŸ‡®â€ŠğŸ‡¨â€Š  ğŸ‡§â€ŠğŸ‡´â€ŠğŸ‡¹â€Š" "cgreen"
sleep 1
clear

pprint "\nğ„ğ§ğ­ğğ« ğ˜ğ¨ğ®ğ« ğğ¨ğ­ ğƒğšğ­ğš ğğğ¥ğ¨ğ°\n\n\n"
pprint "\nğ—”ğ—£ğ—œ ğ—œğ——:- "; color_reset; read api_id
pprint "\nğ—”ğ—£ğ—œ ğ—›ğ—”ğ—¦ğ—›:- "; color_reset; read api_hash
pprint "\nğ—•ğ—¢ğ—§ ğ—§ğ—¢ğ—ğ—˜ğ—¡:- "; color_reset; read bot_token
pprint "\nğ—¢ğ—ªğ—¡ğ—˜ğ—¥ ğ—œğ——:- "; color_reset; read ownid
pprint "\nğ—•ğ—¢ğ—§ ğ—¡ğ—”ğ— ğ—˜:- "; color_reset; read mbt
pprint "\nğ— ğ—¢ğ—¡ğ—šğ—¢ ğ——ğ—•:- "; color_reset; read mongo_db
pprint "\nğ—Ÿğ—¢ğ—š ğ—šğ—¥ğ—¢ğ—¨ğ—£ ğ—œğ——:- "; color_reset; read logger
pprint "\nğ—¦ğ—§ğ—¥ğ—œğ—¡ğ—š ğ—¦ğ—˜ğ—¦ğ—¦ğ—œğ—¢ğ—¡:- "; color_reset; read string_session
pprint "\nğ—šğ—¥ğ—¢ğ—¨ğ—£ ğ—¨ğ—¦ğ—˜ğ—¥ğ—¡ğ—”ğ— ğ—˜:- "; color_reset; read your_group
pprint "\nğ—–ğ—›ğ—”ğ—¡ğ—¡ğ—˜ğ—Ÿ ğ—¨ğ—¦ğ—˜ğ—¥ğ—¡ğ—”ğ— ğ—˜:- "; color_reset; read your_channel

pprint "\n\ğ§ğŸ·ğ‹ğ¨ğšğğ¢ğ§ğ  ğ˜ğ¨ğ®ğ« ğ•ğšğ«ğ¬, ğğ¥ğğšğ¬ğ ğ–ğšğ¢ğ­ ğğšğ›ğ²â™¨ï¸" "cgreen"

if [ -f .env ]; then
	rm .env
fi

echo """API_ID = $api_id
API_HASH = $api_hash
BOT_TOKEN = $bot_token
MONGO_DB_URI = $mongo_db
LOG_GROUP_ID = $logger
YOUR_GROUP = $your_group
YOUR_CHANNEL = $your_channel
MUSIC_BOT_NAME = $mbt
STRING_SESSION = $string_session
OWNER_ID = $ownid""" > .env
clear

pprint "\n\n\n\n\n\n\n\n    __      _______ _____    ___  __ _    _  _____ _____ _____   _____   ____ _______ \n    \ \    / /_   _|  __ \   |  \/  | |  | |/ ____|_   _/ ____|  |  _ \ / __ \__   __|\n     \ \  / /  | | | |__) |  | \  / | |  | | (___   | || |       | |_) | |  | | | |   \n      \ \/ /   | | |  ___/   | |\/| | |  | |\___ \  | || |       |  _ <| |  | | | |   \n       \  /   _| |_| |       | |  | | |__| |____) |_| || |____   | |_) | |__| | | |   \n        \/   |_____|_|       |_|  |_|\____/|_____/|_____\_____|  |____/ \____/  |_|   " 
pprint "\n\n\n\n\\nğğğ– ğ’ğ“ğ€ğ‘ğ“ ğ“ğ‡ğ„ ğğğ“ ğğ˜ ğğ”ğ“ ğ“ğ–ğ ğ‚ğğŒğŒğ€ğğƒ \n\n 1ğ¬ğ­ ğ‚ğ¨ğ¦ğ¦ğšğ§ğ:- tmux \n 2ğ§ğ ğ‚ğ¨ğ¦ğ¦ğšğ§ğ:- bash start\n\n"
